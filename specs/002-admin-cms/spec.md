# Feature Specification: Admin CMS 관리 페이지

**Feature Branch**: `002-admin-cms`
**Created**: 2026-02-06
**Status**: Draft
**Input**: User description: "admin-task.md 기반 Admin CMS 페이지 구현 및 DB 연동. 메인페이지는 변경하지 않음."

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 관리자 로그인 (Priority: P1)

관리자는 이메일과 비밀번호를 사용하여 Admin 페이지에 로그인한다. 로그인에 성공하면 관리 대시보드로 이동하며, 미로그인 상태에서 관리 페이지 접근 시 자동으로 로그인 페이지로 리다이렉트된다.

**Why this priority**: 인증은 모든 관리 기능의 전제 조건이다. 로그인 없이는 어떤 CRUD 작업도 수행할 수 없으므로 최우선 순위이다.

**Independent Test**: 이메일/비밀번호로 로그인 시도 후 관리 대시보드 접근 가능 여부를 확인하여 독립적으로 테스트 가능하다.

**Acceptance Scenarios**:

1. **Given** 등록된 관리자 계정이 존재하고, **When** 올바른 이메일과 비밀번호로 로그인하면, **Then** 관리 대시보드(`/admin`)로 이동한다.
2. **Given** 관리자가 로그인하지 않은 상태에서, **When** `/admin` 경로에 접근하면, **Then** `/admin/login` 페이지로 리다이렉트된다.
3. **Given** 로그인 페이지에서, **When** 잘못된 자격 증명을 입력하면, **Then** 오류 메시지가 표시되고 로그인 페이지에 머문다.

---

### User Story 2 - 제조사 관리 (Priority: P2)

관리자는 제조사 목록을 조회하고, 새로운 제조사를 등록하거나 기존 제조사 정보를 수정할 수 있다. 제조사 로고 이미지를 업로드할 수 있으며, 제조사는 삭제할 수 없다(데이터 무결성 보호). 제조사 목록은 정렬 순서(sort_order) 기준 오름차순으로 표시된다.

**Why this priority**: 제조사는 판매차량의 외래키 참조 대상이므로, 판매차량을 등록하기 전에 제조사 데이터가 먼저 존재해야 한다.

**Independent Test**: 제조사를 등록하고 로고를 업로드한 뒤, 목록에서 해당 제조사가 올바르게 표시되는지 확인하여 독립적으로 테스트 가능하다.

**Acceptance Scenarios**:

1. **Given** 관리자가 로그인한 상태에서, **When** 제조사 관리 탭을 선택하면, **Then** sort_order 오름차순으로 정렬된 제조사 목록이 표시된다.
2. **Given** 제조사 등록 폼에서, **When** 이름, 코드, 카테고리(국산/수입), 정렬순서, 노출여부를 입력하고 로고 이미지를 첨부하여 저장하면, **Then** 제조사가 등록되고 목록에 반영된다.
3. **Given** 기존 제조사가 존재할 때, **When** 수정 버튼을 눌러 정보를 변경하고 저장하면, **Then** 변경된 정보가 반영된다.
4. **Given** 제조사 목록에서, **When** 목록을 확인하면, **Then** 삭제 버튼이 존재하지 않는다.
5. **Given** 로고 이미지를 업로드하여 제조사를 등록할 때, **When** DB 저장이 실패하면, **Then** 업로드된 이미지가 스토리지에서 자동 삭제된다(보상 로직).

---

### User Story 3 - 판매차량 관리 (Priority: P3)

관리자는 판매차량 목록을 조회하고, 새 차량을 등록하거나 기존 차량을 수정 또는 삭제할 수 있다. 등록 시 제조사를 반드시 선택해야 하며, 썸네일 이미지 1장을 업로드할 수 있다. 목록은 등록일 기준 최신순으로 표시된다.

**Why this priority**: 판매차량은 비즈니스의 핵심 데이터이지만, 제조사 데이터에 의존하므로 제조사 관리 이후 순서이다.

**Independent Test**: 제조사가 등록된 상태에서 판매차량을 등록하고 목록에서 확인하여 독립적으로 테스트 가능하다.

**Acceptance Scenarios**:

1. **Given** 관리자가 로그인한 상태에서, **When** 판매차량 관리 탭을 선택하면, **Then** created_at 내림차순으로 정렬된 판매차량 목록이 표시된다.
2. **Given** 판매차량 등록 폼에서, **When** 제조사를 선택하고 차량명, 설명, 렌트가격, 리스가격, 배지, 노출여부를 입력하고 썸네일을 첨부하여 저장하면, **Then** 판매차량이 등록되고 목록에 반영된다.
3. **Given** 등록 폼에서 제조사를 선택하지 않은 상태에서, **When** 저장을 시도하면, **Then** 제조사 선택 필수 안내가 표시되고 저장되지 않는다.
4. **Given** 기존 판매차량이 존재할 때, **When** 수정 또는 삭제 버튼을 눌러 작업하면, **Then** 변경/삭제가 정상 반영된다.
5. **Given** 판매차량 삭제 시, **When** 삭제 버튼을 누르면, **Then** 확인 대화상자가 표시되고 확인 후 삭제가 진행된다.

---

### User Story 4 - 출고차량 관리 (Priority: P4)

관리자는 출고차량 목록을 조회하고, 새 출고차량을 등록하거나 기존 출고차량을 수정 또는 삭제할 수 있다. 썸네일 이미지 1장을 업로드할 수 있으며, 출고일을 지정한다. 목록은 등록일 기준 최신순으로 표시된다.

**Why this priority**: 출고차량은 독립적인 엔티티로 다른 데이터에 대한 의존성이 없으므로 마지막 순서이다.

**Independent Test**: 출고차량을 등록하고 목록에서 확인하여 독립적으로 테스트 가능하다.

**Acceptance Scenarios**:

1. **Given** 관리자가 로그인한 상태에서, **When** 출고차량 관리 탭을 선택하면, **Then** created_at 내림차순으로 정렬된 출고차량 목록이 표시된다.
2. **Given** 출고차량 등록 폼에서, **When** 차량명, 출고일, 노출여부를 입력하고 썸네일을 첨부하여 저장하면, **Then** 출고차량이 등록되고 목록에 반영된다.
3. **Given** 기존 출고차량이 존재할 때, **When** 수정 또는 삭제 버튼을 눌러 작업하면, **Then** 변경/삭제가 정상 반영된다.
4. **Given** 출고차량 삭제 시, **When** 삭제 버튼을 누르면, **Then** 확인 대화상자가 표시되고 확인 후 삭제가 진행된다.

---

### Edge Cases

- 관리자가 이미지 업로드 후 DB 저장에 실패하면 어떻게 되는가? → 스토리지에 업로드된 이미지가 자동으로 삭제된다 (보상 로직).
- 제조사에 연결된 판매차량이 있는 상태에서 해당 제조사를 삭제하려 하면 어떻게 되는가? → 제조사는 삭제 기능 자체가 제공되지 않는다.
- 렌트 가격과 리스 가격 모두 미입력인 판매차량을 등록하려 하면? → 둘 다 선택 입력이므로 허용된다 (가격 미정 상태로 등록 가능).
- 이미 사용 중인 제조사 코드로 새 제조사를 등록하려 하면? → 고유 코드 중복 오류가 표시된다.
- 대용량 이미지 파일을 업로드하면? → 적절한 파일 크기 제한(5MB)을 적용하고, 초과 시 안내 메시지를 표시한다.
- 지원하지 않는 이미지 형식을 업로드하면? → 허용된 형식(SVG, WebP, PNG, JPG)만 수락하고 안내 메시지를 표시한다.
- 세션이 만료된 상태에서 데이터를 저장하려 하면? → 인증 실패 응답을 받고 로그인 페이지로 리다이렉트된다.

## Requirements *(mandatory)*

### Functional Requirements

**인증**
- **FR-001**: 시스템은 이메일/비밀번호 방식으로 관리자 인증을 제공해야 한다.
- **FR-002**: 미인증 상태에서 관리 페이지 접근 시 로그인 페이지로 리다이렉트해야 한다.
- **FR-003**: 모든 데이터 변경 요청(생성/수정/삭제)은 서버 측에서 인증 여부를 검증해야 한다.

**관리 대시보드 구조**
- **FR-004**: 관리 대시보드는 3개의 탭(제조사 관리, 판매차량 관리, 출고차량 관리)으로 구성되어야 한다.
- **FR-005**: 관리 UI는 메인 페이지의 기존 테마(색상, 스타일)와 일관성을 유지해야 한다.

**제조사 관리**
- **FR-006**: 시스템은 제조사를 정렬 순서(sort_order) 오름차순으로 목록 조회할 수 있어야 한다.
- **FR-007**: 관리자는 제조사를 등록할 수 있어야 한다 (코드, 이름, 카테고리, 정렬순서, 노출여부, 로고 이미지).
- **FR-008**: 관리자는 기존 제조사 정보를 수정할 수 있어야 한다.
- **FR-009**: 제조사 삭제 기능은 제공되지 않아야 한다 (UI에 삭제 버튼 없음).
- **FR-010**: 제조사 카테고리는 '국산(DOMESTIC)' 또는 '수입(IMPORT)' 중 하나를 선택해야 한다.
- **FR-011**: 제조사 코드는 고유해야 하며, 중복 시 오류를 표시해야 한다.

**판매차량 관리**
- **FR-012**: 시스템은 판매차량을 등록일(created_at) 내림차순으로 목록 조회할 수 있어야 한다.
- **FR-013**: 관리자는 판매차량을 등록할 수 있어야 한다 (제조사 선택, 차량명, 설명, 렌트가격, 리스가격, 배지, 노출여부, 썸네일 이미지).
- **FR-014**: 판매차량 등록 시 제조사 선택은 필수이다.
- **FR-015**: 렌트 가격과 리스 가격은 선택 입력이다 (가격 미정 상태 허용).
- **FR-016**: 관리자는 기존 판매차량을 수정할 수 있어야 한다.
- **FR-017**: 관리자는 판매차량을 삭제할 수 있어야 하며, 삭제 전 확인 대화상자가 표시되어야 한다.

**출고차량 관리**
- **FR-018**: 시스템은 출고차량을 등록일(created_at) 내림차순으로 목록 조회할 수 있어야 한다.
- **FR-019**: 관리자는 출고차량을 등록할 수 있어야 한다 (차량명, 출고일, 노출여부, 썸네일 이미지).
- **FR-020**: 관리자는 기존 출고차량을 수정할 수 있어야 한다.
- **FR-021**: 관리자는 출고차량을 삭제할 수 있어야 하며, 삭제 전 확인 대화상자가 표시되어야 한다.

**이미지 업로드**
- **FR-022**: 각 엔티티(제조사, 판매차량, 출고차량)는 대표 이미지 1장만 허용한다.
- **FR-023**: 이미지 파일은 저장 버튼 클릭 시점에 서버로 전송되어야 한다 (사전 임시 업로드 없음).
- **FR-024**: 이미지 업로드 성공 후 DB 저장이 실패하면, 업로드된 이미지를 스토리지에서 자동 삭제해야 한다 (보상 로직).
- **FR-025**: 이미지 파일 크기는 5MB 이하로 제한한다.
- **FR-026**: 허용되는 이미지 형식은 SVG, WebP, PNG, JPG이다.

**데이터 무결성**
- **FR-027**: 스토리지에는 이미지 파일의 경로(path)만 DB에 저장한다 (전체 URL이 아님).
- **FR-028**: 데이터 수정 시 updated_at 필드가 자동으로 갱신되어야 한다.

### Key Entities

- **제조사(Manufacturer)**: 차량을 생산하는 회사. 코드(고유), 이름, 로고 이미지, 카테고리(국산/수입), 정렬순서, 노출여부를 가진다.
- **판매차량(SaleCar)**: 현재 판매 중인 차량. 제조사에 소속되며, 차량명, 설명, 썸네일, 렌트/리스 가격, 배지 목록, 노출여부를 가진다.
- **출고차량(ReleasedCar)**: 출고 완료된 차량. 차량명, 썸네일, 출고일, 노출여부를 가진다.

## Assumptions

- DB 테이블(manufacturers, sale_cars, released_cars)은 이미 생성되어 있다.
- Supabase Storage의 public bucket이 이미 구성되어 있다.
- 관리자 계정은 Supabase Auth에 사전 등록되어 있다 (회원가입 기능은 범위 밖).
- 메인(공개) 페이지는 본 기능의 구현 범위에 포함되지 않으며 변경하지 않는다.
- 단일 관리자 운영을 가정하며, 역할 기반 접근 제어는 필요하지 않다.
- 파일 크기 제한은 5MB로 설정한다 (일반적인 웹 이미지 업로드 기준).
- 삭제 시 확인 대화상자는 브라우저 기본 확인 대화상자 또는 커스텀 모달로 구현한다.

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 관리자가 로그인부터 데이터 등록까지 전체 워크플로우를 2분 이내에 완료할 수 있다.
- **SC-002**: 모든 CRUD 작업(등록/수정/삭제)이 사용자 조작 후 3초 이내에 결과가 반영된다.
- **SC-003**: 이미지 업로드 후 DB 저장 실패 시 100% 보상 로직이 실행되어 스토리지에 고아 파일이 남지 않는다.
- **SC-004**: 미인증 사용자의 관리 페이지 접근이 100% 차단되고 로그인 페이지로 리다이렉트된다.
- **SC-005**: 3개 관리 탭(제조사, 판매차량, 출고차량) 모두에서 목록 조회, 등록, 수정 기능이 정상 동작한다 (판매차량/출고차량은 삭제 포함).
- **SC-006**: 관리자가 별도의 매뉴얼 없이 직관적으로 모든 관리 기능을 사용할 수 있다.
